openapi: 3.0.1
info:
  title: Pax8 Contacts API
  description: CRUD operations for company contacts with page-based pagination.
  version: 1.0.0

servers:
  - url: https://api.pax8.com/v1

security:
  - bearerAuth: []

paths:
  /companies/{companyId}/contacts:
    get:
      operationId: listContacts
      summary: List contacts for a company
      description: Returns a page-based paginated list of contacts ordered by createdDate descending.
      tags:
        - Contacts
      parameters:
        - $ref: '#/components/parameters/CompanyId'
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Size'
      responses:
        '200':
          description: Contacts page
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContactListResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Company not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          description: Rate limited
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      operationId: createContact
      summary: Create a new contact
      description: Creates a new contact for the specified company.
      tags:
        - Contacts
      parameters:
        - $ref: '#/components/parameters/CompanyId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateContactRequest'
      responses:
        '201':
          description: Contact created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Contact'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Company not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          description: Rate limited
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /companies/{companyId}/contacts/{contactId}:
    get:
      operationId: getContact
      summary: Get contact by ID
      description: Returns a single contact by ID.
      tags:
        - Contacts
      parameters:
        - $ref: '#/components/parameters/CompanyId'
        - $ref: '#/components/parameters/ContactId'
      responses:
        '200':
          description: Contact found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Contact'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Company or contact not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          description: Rate limited
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    put:
      operationId: updateContact
      summary: Update a contact
      description: Updates an existing contact. Supports partial updates.
      tags:
        - Contacts
      parameters:
        - $ref: '#/components/parameters/CompanyId'
        - $ref: '#/components/parameters/ContactId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateContactRequest'
      responses:
        '200':
          description: Contact updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Contact'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Company or contact not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          description: Rate limited
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      operationId: deleteContact
      summary: Delete a contact
      description: Deletes a contact.
      tags:
        - Contacts
      parameters:
        - $ref: '#/components/parameters/CompanyId'
        - $ref: '#/components/parameters/ContactId'
      responses:
        '204':
          description: Contact deleted
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Company or contact not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          description: Rate limited
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    CompanyId:
      name: companyId
      in: path
      required: true
      schema:
        type: string
        format: uuid
      description: Unique company identifier

    ContactId:
      name: contactId
      in: path
      required: true
      schema:
        type: string
        format: uuid
      description: Unique contact identifier

    Page:
      name: page
      in: query
      required: false
      schema:
        type: integer
        minimum: 0
        default: 0
      description: Page number (0-indexed)

    Size:
      name: size
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 200
        default: 10
      description: Number of contacts per page

  schemas:
    ContactType:
      type: object
      required:
        - type
        - primary
      properties:
        type:
          type: string
          enum:
            - Admin
            - Billing
            - Technical
          description: Contact role type
        primary:
          type: boolean
          description: Whether this contact is primary for this type

    Contact:
      type: object
      required:
        - id
        - firstName
        - lastName
        - email
        - createdDate
      properties:
        id:
          type: string
          format: uuid
          description: Unique contact identifier
        firstName:
          type: string
          description: First name
        lastName:
          type: string
          description: Last name
        email:
          type: string
          format: email
          description: Email address
        phone:
          type: string
          description: Phone number
        types:
          type: array
          items:
            $ref: '#/components/schemas/ContactType'
          description: Contact type assignments
        createdDate:
          type: string
          format: date-time
          description: ISO 8601 creation timestamp

    CreateContactRequest:
      type: object
      required:
        - firstName
        - lastName
        - email
      properties:
        firstName:
          type: string
          description: First name
        lastName:
          type: string
          description: Last name
        email:
          type: string
          format: email
          description: Email address
        phone:
          type: string
          description: Phone number
        types:
          type: array
          items:
            $ref: '#/components/schemas/ContactType'
          description: Contact type assignments

    UpdateContactRequest:
      type: object
      properties:
        firstName:
          type: string
          description: First name
        lastName:
          type: string
          description: Last name
        email:
          type: string
          format: email
          description: Email address
        phone:
          type: string
          description: Phone number
        types:
          type: array
          items:
            $ref: '#/components/schemas/ContactType'
          description: Contact type assignments

    PageMetadata:
      type: object
      required:
        - size
        - totalElements
        - totalPages
        - number
      properties:
        size:
          type: integer
          minimum: 1
          maximum: 200
          description: Page size
        totalElements:
          type: integer
          description: Total contacts available
        totalPages:
          type: integer
          description: Total pages based on size
        number:
          type: integer
          description: Current page number (0-indexed)

    ContactListResponse:
      type: object
      required:
        - content
        - page
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/Contact'
          description: Contacts on this page
        page:
          $ref: '#/components/schemas/PageMetadata'

    ErrorResponse:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          description: Machine-readable error code
          enum:
            - unauthorized
            - not_found
            - validation_error
            - rate_limited
        message:
          type: string
          description: Human-readable message
        details:
          type: object
          additionalProperties: true
          description: Field-level validation details
