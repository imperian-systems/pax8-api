# Data Model: Usage Summaries API

**Generated by**: `/speckit.plan` Phase 1

## Overview

TypeScript type definitions for Usage Summaries API entities, based on Pax8 Partner API OpenAPI specification.

---

## Entities

### UsageSummary

Represents a usage summary for a subscription within a billing period.

```typescript
/**
 * Usage summary for a subscription.
 * Aggregates usage data for a specific product within a subscription.
 * @see https://devx.pax8.com/openapi/6463f53f2c9755000aaf50be - UsageSummary schema
 */
export interface UsageSummary {
  /** Unique identifier for the usage summary */
  id: string;
  
  /** Company ID associated with this usage */
  companyId: string;
  
  /** Product ID for the usage */
  productId: string;
  
  /** Resource group name (e.g., "Office 365 E3") */
  resourceGroup: string;
  
  /** Vendor name (e.g., "Microsoft") */
  vendorName: string;
  
  /** Current charges for this usage period */
  currentCharges: number;
  
  /** ISO 4217 currency code (e.g., "USD") */
  currencyCode: string;
  
  /** Partner's total amount */
  partnerTotal: number;
  
  /** Whether this is a trial subscription */
  isTrial: boolean;
}
```

**Source**: Pax8 Partner API OpenAPI - UsageSummary component

---

### UsageLine

Represents a single usage line item within a usage summary.

```typescript
/**
 * Individual usage line item within a usage summary.
 * Contains detailed usage data for a specific date.
 * @see https://devx.pax8.com/openapi/6463f53f2c9755000aaf50be - UsageLine schema
 */
export interface UsageLine {
  /** ID of the parent usage summary */
  usageSummaryId: string;
  
  /** Date of the usage (ISO 8601 format) */
  usageDate: string;
  
  /** Product name for this line item */
  productName: string;
  
  /** Product ID */
  productId: string;
  
  /** Unit of measure (e.g., "User", "GB") */
  unitOfMeasure: string;
  
  /** Quantity consumed */
  quantity: number;
  
  /** Current charges for this line */
  currentCharges: number;
  
  /** Current profit for partner */
  currentProfit: number;
  
  /** Partner's total for this line */
  partnerTotal: number;
  
  /** Unit price */
  unitPrice: number;
  
  /** ISO 4217 currency code */
  currencyCode: string;
  
  /** Whether this is from a trial subscription */
  isTrial: boolean;
}
```

**Source**: Pax8 Partner API OpenAPI - UsageLine component

---

## Request Options

### ListUsageSummariesOptions

Options for listing usage summaries for a subscription.

```typescript
/**
 * Options for listing usage summaries.
 * Extends standard pagination options.
 */
export interface ListUsageSummariesOptions {
  /** Page number (0-indexed) */
  page?: number;
  
  /** Page size (1-200, default varies by endpoint) */
  size?: number;
  
  /** Sort field */
  sort?: string;
}
```

---

### ListUsageLinesOptions

Options for listing usage lines within a usage summary.

```typescript
/**
 * Options for listing usage lines.
 * Note: usageDate is REQUIRED by the Pax8 API.
 */
export interface ListUsageLinesOptions {
  /** 
   * Date for which to retrieve usage lines (ISO 8601 format).
   * REQUIRED - API returns 400 without this parameter.
   */
  usageDate: string;
  
  /** Page number (0-indexed) */
  page?: number;
  
  /** Page size (1-200) */
  size?: number;
  
  /** Sort field */
  sort?: string;
}
```

---

## Response Types

### PagedResponse<T>

Uses existing `PagedResponse<T>` from models.

```typescript
// From existing src/models/common.ts or similar
export interface PagedResponse<T> {
  page: {
    number: number;
    size: number;
    totalPages: number;
    totalElements: number;
  };
  content: T[];
}
```

---

## Entity Relationships

```
Subscription (1) ────┬──── (N) UsageSummary
                     │
                     └──── resourceGroup, productId, companyId

UsageSummary (1) ────┬──── (N) UsageLine
                     │
                     └──── usageSummaryId, usageDate
```

**Relationships**:
- A Subscription has many UsageSummaries (accessed via `/subscriptions/{id}/usage-summaries`)
- A UsageSummary has many UsageLines (accessed via `/usage-summaries/{id}/usage-lines?usageDate=...`)
- UsageLine requires usageDate to fetch (filters by date within the summary)

---

## Validation Rules

### UsageSummary

| Field | Type | Required | Validation |
|-------|------|----------|------------|
| id | string | Yes | Non-empty, UUID format |
| companyId | string | Yes | Non-empty, UUID format |
| productId | string | Yes | Non-empty, UUID format |
| resourceGroup | string | Yes | Non-empty string |
| vendorName | string | Yes | Non-empty string |
| currentCharges | number | Yes | Numeric (can be 0 or negative for credits) |
| currencyCode | string | Yes | ISO 4217 (3 chars) |
| partnerTotal | number | Yes | Numeric |
| isTrial | boolean | Yes | Boolean |

### UsageLine

| Field | Type | Required | Validation |
|-------|------|----------|------------|
| usageSummaryId | string | Yes | Non-empty, UUID format |
| usageDate | string | Yes | ISO 8601 date format |
| productName | string | Yes | Non-empty string |
| productId | string | Yes | Non-empty, UUID format |
| unitOfMeasure | string | Yes | Non-empty string |
| quantity | number | Yes | Numeric (≥ 0) |
| currentCharges | number | Yes | Numeric |
| currentProfit | number | Yes | Numeric |
| partnerTotal | number | Yes | Numeric |
| unitPrice | number | Yes | Numeric (≥ 0) |
| currencyCode | string | Yes | ISO 4217 (3 chars) |
| isTrial | boolean | Yes | Boolean |

---

## Type Assertion Functions

```typescript
/**
 * Type guard for UsageSummary
 */
export function isUsageSummary(obj: unknown): obj is UsageSummary {
  return (
    typeof obj === 'object' &&
    obj !== null &&
    typeof (obj as UsageSummary).id === 'string' &&
    typeof (obj as UsageSummary).companyId === 'string' &&
    typeof (obj as UsageSummary).productId === 'string' &&
    typeof (obj as UsageSummary).resourceGroup === 'string' &&
    typeof (obj as UsageSummary).vendorName === 'string' &&
    typeof (obj as UsageSummary).currentCharges === 'number' &&
    typeof (obj as UsageSummary).currencyCode === 'string' &&
    typeof (obj as UsageSummary).partnerTotal === 'number' &&
    typeof (obj as UsageSummary).isTrial === 'boolean'
  );
}

/**
 * Assertion function for UsageSummary
 */
export function assertUsageSummary(obj: unknown): asserts obj is UsageSummary {
  if (!isUsageSummary(obj)) {
    throw new Error('Invalid UsageSummary object');
  }
}

/**
 * Type guard for UsageLine
 */
export function isUsageLine(obj: unknown): obj is UsageLine {
  return (
    typeof obj === 'object' &&
    obj !== null &&
    typeof (obj as UsageLine).usageSummaryId === 'string' &&
    typeof (obj as UsageLine).usageDate === 'string' &&
    typeof (obj as UsageLine).productName === 'string' &&
    typeof (obj as UsageLine).productId === 'string' &&
    typeof (obj as UsageLine).unitOfMeasure === 'string' &&
    typeof (obj as UsageLine).quantity === 'number' &&
    typeof (obj as UsageLine).currentCharges === 'number' &&
    typeof (obj as UsageLine).currentProfit === 'number' &&
    typeof (obj as UsageLine).partnerTotal === 'number' &&
    typeof (obj as UsageLine).unitPrice === 'number' &&
    typeof (obj as UsageLine).currencyCode === 'string' &&
    typeof (obj as UsageLine).isTrial === 'boolean'
  );
}

/**
 * Assertion function for UsageLine
 */
export function assertUsageLine(obj: unknown): asserts obj is UsageLine {
  if (!isUsageLine(obj)) {
    throw new Error('Invalid UsageLine object');
  }
}
```
